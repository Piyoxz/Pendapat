<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daftar Pendapat</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css"
    />
    <style>
      body {
        font-family: "Arial", sans-serif;
        background-color: #f5f5f5;
        margin: 0;
        padding: 20px;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
      }

      .pendapat-list {
        list-style: none;
        padding: 0;
      }

      .pendapat-box {
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        margin-bottom: 20px;
        overflow: hidden;
        transition: transform 0.3s;
      }

      .pendapat-box:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .tanggal {
        background-color: #f5f5f5;
        color: #777;
        padding: 8px;
        border-bottom: 1px solid #ddd;
        border-radius: 8px 8px 0 0;
      }

      .pendapat {
        font-size: 16px;
        padding: 20px;
        border-top: 1px solid #ddd;
      }

      .back-btn {
        display: inline-block;
        padding: 10px 20px;
        background-color: #007bff;
        color: #fff;
        text-decoration: none;
        border-radius: 4px;
        margin-bottom: 20px;
        cursor: pointer;
      }

      .back-icon {
        margin-right: 10px;
      }

      .loading {
        font-size: 16px;
        color: #555;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <a href="javascript:history.back()" class="back-btn">
        <span class="back-icon">&#8592;</span> Kembali
      </a>

      <h2 class="text-center">Daftar Pendapat</h2>
      <div class="notice">Created by piyo</div>

      <ul class="pendapat-list" id="daftarPendapat"></ul>
      <div id="loading" class="loading">Memuat...</div>
    </div>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/toastify-js"
    ></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const daftarPendapat = document.getElementById("daftarPendapat");
        const loading = document.getElementById("loading");

        let lastDataId = null;

        function loadInitialData() {
          fetch("https://65ca31733b05d29307dfea81.mockapi.io/api/data")
            .then((response) => response.json())
            .then((data) => {
              loading.style.display = "none";

              data.forEach((pendapat) => {
                const li = document.createElement("li");
                li.classList.add("pendapat-box");

                const tanggal = document.createElement("div");
                 const timestamp = parseInt(pendapat.tanggal);
                  const date = new Date(timestamp * 1000); // Konversi ke milidetik (timestamp dalam detik)

// Mendapatkan informasi tanggal dan waktu
const tahun = date.getFullYear();
const bulan = date.getMonth() + 1; // Perlu ditambah 1 karena indeks bulan dimulai dari 0
const hari = date.getDate();
const jam = date.getHours();
const menit = date.getMinutes();
const detik = date.getSeconds();

// Membuat format tanggal dan waktu yang lebih mudah dibaca
const formatTanggalWaktu = `${tahun}-${bulan < 10 ? '0' + bulan : bulan}-${hari < 10 ? '0' + hari : hari} ${jam < 10 ? '0' + jam : jam}:${menit < 10 ? '0' + menit : menit}:${detik < 10 ? '0' + detik : detik}`;

                tanggal.classList.add("tanggal");
                tanggal.textContent = pendapat.formatTanggalWaktu;
                li.appendChild(tanggal);

                const isiPendapat = document.createElement("div");
                isiPendapat.classList.add("pendapat");
                isiPendapat.textContent = pendapat.pendapat;
                li.appendChild(isiPendapat);

                daftarPendapat.appendChild(li);

                lastDataId = pendapat.id;
              });
            })
            .catch((error) => {
              console.error("Error:", error);
              loading.textContent =
                "Terjadi kesalahan saat mengambil data awal.";
            });
        }

        function loadNewData() {
          fetch("https://65ca31733b05d29307dfea81.mockapi.io/api/data")
            .then((response) => response.json())
            .then((data) => {
              data.forEach((pendapat) => {
                if (pendapat.id > lastDataId) {
                  const li = document.createElement("li");
                  li.classList.add("pendapat-box");

                  const tanggal = document.createElement("div");
                  const timestamp = parseInt(pendapat.tanggal);
                  const date = new Date(timestamp * 1000); // Konversi ke milidetik (timestamp dalam detik)

// Mendapatkan informasi tanggal dan waktu
const tahun = date.getFullYear();
const bulan = date.getMonth() + 1; // Perlu ditambah 1 karena indeks bulan dimulai dari 0
const hari = date.getDate();
const jam = date.getHours();
const menit = date.getMinutes();
const detik = date.getSeconds();

// Membuat format tanggal dan waktu yang lebih mudah dibaca
const formatTanggalWaktu = `${tahun}-${bulan < 10 ? '0' + bulan : bulan}-${hari < 10 ? '0' + hari : hari} ${jam < 10 ? '0' + jam : jam}:${menit < 10 ? '0' + menit : menit}:${detik < 10 ? '0' + detik : detik}`;
                  tanggal.classList.add("tanggal");
                  tanggal.textContent = pendapat.formatTanggalWaktu;
                  li.appendChild(tanggal);

                  const isiPendapat = document.createElement("div");
                  isiPendapat.classList.add("pendapat");
                  isiPendapat.textContent = pendapat.pendapat;
                  li.appendChild(isiPendapat);

                  daftarPendapat.appendChild(li);

                  lastDataId = pendapat.id;

                  showToast(pendapat.pendapat);
                }
              });
            })
            .catch((error) => {
              console.error("Error:", error);
              loading.textContent =
                "Terjadi kesalahan saat mengambil data baru.";
            });
        }

        loadInitialData();

        setInterval(loadNewData, 5000);
      });

      function showToast(message) {
        Toastify({
          text: "Pendapat baru: " + message,
          duration: 3000,
          close: true,
          gravity: "top",
          position: "right",
          style: {
            background: "linear-gradient(to right, #00b09b, #96c93d)",
          },
        }).showToast();
      }
    </script>
  </body>
</html>
